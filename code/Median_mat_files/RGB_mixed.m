function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 10-Sep-2016 22:47:20.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1.68225153850844;1.687733747403;1.70088193744179;3.56593361078692;3.45662522547845;3.60147221533988;0.723617941859257;0.725898031813287;0.726295797281729;13.3568434105256;16.3443348591275;14.6281154737623];
x1_step1_gain = [2.42406547682654;2.32126603953241;2.4914707519352;0.71947883299075;0.676700786631049;0.758646775899407;6.32337134845644;6.53337286453065;6.32832003762608;0.147296617569698;0.170208028017692;0.160878229205209];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.6801828395614256;2.2457703526307857;2.2036162444444005;1.3807666263505141;1.8907058269122556;-0.88241547742689053;0.024266403784497358;-0.63995664633940785;0.42616126144959932;-0.12417499917771481;0.076302854663448869;1.0293766160677311;0.47654242256316576;1.3632952980500463;0.39032238428164345;-1.5543047503789464;-1.8261472913791639;-2.67605087808652;1.9279049888824482;1.5413818329247486];
IW1_1 = [1.3581318060200156 -0.30360551118182638 0.024030240134008295 0.21537008241357344 0.26539789777221273 0.63593398286469305 0.607904030596914 -1.8407015476170199 -0.044786652495578248 0.64716912385445646 1.1039189314707476 1.143230955911497;-0.065379754954619396 0.21807492128267858 0.14883951437413651 -0.74497027767443902 0.1958951019539934 0.8170614260503426 -0.11517716389076892 -0.085728315541298186 0.4990783839797322 0.15747143617572865 -0.38312603218865815 -0.13386257669959126;-2.2025693962348289 -0.1035070533701517 0.36925758438390166 2.0247454480975278 1.3105520599080061 1.344843181820891 -1.6780202633341861 0.76307757902025164 1.2533352465365724 -1.0030351083199918 0.61805089005637737 -0.45723089801034189;-2.9530074170944052 -0.60453231698489551 0.45773156649939462 1.1475678243829519 1.1382506297496786 -0.60567727370541036 -0.14747967165270709 0.42342088457098803 2.8532849169779353 0.33010401714925314 -1.7647217219359674 0.86389581500258594;0.44866200963338343 -1.8332872104266491 -0.79019276484555812 -0.83991447620471205 -0.94899836689360151 -1.7681282973342978 -2.2463524491792461 0.29970078034087733 0.20704936524022663 1.3808557140509969 1.5318898031947918 0.12301264532377088;0.14589014591238142 -0.43966688440741958 -0.2978154440555813 -0.4866898563527382 -0.027828227934433278 0.66909490051343845 -0.57032536601175854 -1.2629835189203216 1.1844350538903861 -0.54515103174743118 -1.0283912022786417 -0.51782257988614178;0.4812631416737288 -3.1368604883199729 -3.178914483391273 -1.9976984323822304 0.3865722506656894 0.58402282670103456 -0.44367676867313321 1.7389357617210419 2.4193551825225161 -0.63093700868542291 -0.1930119593668507 -0.73610436265965218;-0.88531677885426063 1.367074048602906 -0.13963352950185431 -0.15956249782172277 0.46135599910545727 0.27439846510666394 -0.57179634081843267 -1.1633557085843607 -1.2043447828904503 -1.5615754032101932 -2.1519263312340451 1.1076926700603082;0.2660245345285347 -0.68197450652344593 -0.61126161959957337 -0.04199177042417615 -0.56409778463798499 1.457069670265422 0.17912677729411294 -0.92336797545953675 0.77025578326641897 1.3284364972876868 2.9340527798740803 0.3176892992157731;-3.031938750474819 -1.4709000805919639 1.0994959133864957 -0.92053913952874944 -1.7029365735168749 -2.4258966807833278 -0.77463074978643398 -1.9329753954038018 -0.76745005252239462 -1.4807224538012171 0.19152122090334761 1.523825693009311;2.0162466869653843 -1.1990765689214886 0.60652194248341706 -1.0770542069890698 0.8843731233663622 0.80226199861265524 0.55487063277375692 -0.79827144724771593 2.0197449424764859 0.89686733807159646 -0.085236332434918516 0.29001418829182291;-1.7556375980355705 2.5211155805234968 -1.4924175046071804 2.1614990793633844 0.949293683187582 -1.1021223100706239 0.70273839473692767 1.9162523750522413 1.1106900155849813 -1.254559343258302 -1.6289806504959798 0.11026539291918176;0.23103074985905386 0.1519885582706427 0.78119620167301185 -0.39233375008359112 -0.77037817520082563 0.47948672112968055 -1.6504074403260809 -0.63869926833725277 -0.4679139271210257 -0.16405522219505642 -0.24527503622963023 -0.47175618015193943;3.1449367263317667 0.029689765006547422 1.3958463279629216 -0.049367421954799748 0.2204093610620064 -1.4342653109444525 0.61269835984597232 -0.22576875064870797 -0.51452578068999832 0.55449064856319463 -0.44516798187046791 -1.1645736194900485;1.2502243525407426 -0.61414079886739725 2.3255910651924636 -0.54660591460955121 -1.4372511707755884 2.7351907695997202 0.14470186585759867 -1.07602711523395 0.48496382201384169 0.5503758002965462 -0.10950041116540087 2.0061483155836668;-0.19097728721374319 -0.75854782776331042 -0.109782577612438 0.37324379775018168 0.10823415163386119 -0.77919536752157681 -2.6509393186982626 1.1761484330683671 1.0090870693815579 -2.6420857416758623 -1.132021698475502 -2.0635641196928001;-0.32107652447124263 -0.27907335621715579 -0.67618278404906418 -0.26552840000089378 -0.42062829726147294 0.70539959561913057 -0.46506592379988204 -0.19982590502337905 0.88301986197426163 -0.26332522787454049 -0.23321162500250808 0.23437487446752939;-1.4325018486724315 -1.8437353087187736 1.0627596975585005 -0.61672485427343693 0.25702107653400347 1.7478951146860868 -0.054891696012736864 0.63908833618800009 -0.92515311364237141 1.5887947989034459 0.11787410582298405 -0.63459393398152919;1.2860919345737942 0.57116830552719566 0.02689139410878158 0.38549376480372005 -1.366463171048433 0.63298967163722097 0.60253498741635503 -0.93731798014886336 1.8292366678858396 -0.69045021806105333 0.20030589135978896 0.033666127132664148;0.31835170046494876 -0.72194069328677812 -2.3969493998676663 0.60590343385467105 0.40009993372267993 -0.4490854068967246 -1.5782745269832013 -0.61495101452576484 0.67240302592936751 -0.86651683308867522 -0.2735254714450826 -1.2663757468325525];

% Layer 2
b2 = [-0.19916782192218838;-0.75103789560752998;-0.54829953842587564];
LW2_1 = [2.2227218441886931 0.55238695751999334 -2.824700568686735 2.3440791453400576 2.7446299750590892 -0.96946574062657398 -4.2014004843642354 3.3557747088431173 0.65300447700818776 0.14799945883975246 2.1014192731434966 1.5059312954165038 0.25550305580366017 1.3783783108687853 -3.4062918547825713 2.23706303415684 -0.42413975343363403 2.5065167074819716 -0.11008683753136307 -0.57738760014190482;-1.1490426442015533 -0.80035127105434867 -1.5177850282266505 0.88942903050126976 -0.090695936487252174 -0.1563425390290869 0.54243307756902459 -1.8197779221718653 -3.0277864473600533 -3.1008271643404344 -1.0399692520437558 -3.9773066181868271 1.3663888551270391 -2.1578858043202951 1.2082916114362734 -3.1342557969897751 0.66743037517711412 -0.60746496400053507 -1.9061508976168962 1.5985197135728082;-0.8196812899750765 -0.23311498921438029 2.6559971990194433 -3.5076586201235957 -2.8733816191907344 1.0873326208453384 3.6429245145232656 -0.87886851742724381 1.5857088854643324 3.0956224318421999 -0.76606027993153358 1.8120171642922853 0.29894592307409112 0.77487398343772174 1.3597725653167443 0.39040575493985469 0.91787944358478701 -2.3647949136035615 2.4540684934307988 -2.2616134044124925];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
