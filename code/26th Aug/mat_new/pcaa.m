function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 08-Sep-2016 16:57:54.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 5xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [-45.2656230253469;-23.669745321624;-12.2221453948146;-11.0906907676756;-6.82330769612111];
x1_step1_gain = [0.0318445774493276;0.0511707288857879;0.0812646738495974;0.08521718882941;0.0815387165960207];
x1_step1_ymin = -1;

% Layer 1
b1 = [-1.8609047734925468;-2.4504870451333916;-2.5024785292463112;-2.575094446740259;2.021347473832078;2.2139034869667724;0.64576492323998624;1.8527045131023505;1.016270876018583;1.6908547904119491;1.4759489027240738;-0.33692503456612327;-0.012670381302782778;-0.51558927694981671;0.47494999010999545;0.23486525074966549;0.59450576784047404;0.2997737692163791;0.48876310129949346;-1.2066042144652303;-1.1164580339494805;1.0131967493079259;0.93275678670360562;-1.7504883428414602;-1.8083807064925832;2.3495230548673129;-1.5979432756293512;2.462081436188793;2.1157698582263342;2.4633618893600651;2.4625002122658861;2.824614903035211];
IW1_1 = [2.0015501918864405 -2.4791236073675464 0.034400544680618088 -2.3721208074413109 -0.81381319738522584;1.0147370904290953 -0.53038560993125172 -1.5052086288657283 0.13104081973822049 2.3285273688757719;0.71341734282822655 2.6876763543656819 -0.28806536205549749 -0.37898787210266477 -2.1360481155340669;0.70635622616671223 -1.1072826962182247 1.5242799923584305 -1.5442804350612893 -0.28865282577020968;-0.92977182265981273 1.405007935111082 -1.4291970539711381 0.79758320009684802 -1.5267546108273029;-0.95837779099334908 -0.91625478924163573 1.5946903164073545 1.3360253124473775 0.92353320334261368;-1.0021357547949932 -0.74273920199881871 1.8936001054025424 1.4699182557315955 1.5244280803132555;-1.1032161155911573 -0.25666576303466393 -1.0933624457065318 -1.0009138206186561 -2.2410072324081325;-1.333459322309765 -2.225356794238412 1.722986389751445 0.28806102600826688 0.65675621614021418;0.42879705816406499 -0.45006354247893032 0.32558112697246955 -2.4975547792844246 0.9963055247319792;-0.81205716439756581 1.0405397702053045 -1.6264593890459071 0.17461706847241526 -1.8604765740501821;1.4320542895865171 -1.5344158591900097 1.3240274538236201 1.7166935769734697 -1.3775169581787119;-1.9764324407322087 -0.9040433955329803 1.4745482162125327 -0.74563938600139124 -0.64463248489776015;1.216146394295393 1.0643941537396993 -1.5165503705897319 -0.35946805738733556 1.3964387798624662;2.2990988913427888 -0.67894561057894798 0.03634927143726463 0.59907139136843857 1.0219290484202368;0.79178933844303756 1.4368588041766728 -3.1532743043914659 -0.94362552278276557 0.71216224513820081;1.6003840892022729 -1.8767518219479353 0.70315025223994199 -1.0296346260714415 0.014174270922353408;1.0051101758941516 2.7919452030915846 -0.75025953164011927 0.33968306922214464 0.46287431962821213;0.82785136246763136 2.4775173793074141 2.1379152518263052 0.087163652273120215 -1.129952483744588;1.2813186280457767 -1.7033677286251552 0.78371126635678434 -0.30567255291390627 1.4163942195443833;-1.1317246975703832 -0.8428905883762845 0.96027796210176419 -0.40071272316296869 -1.707699466606893;0.94793613315271097 0.89666767730278663 1.6958337901413898 2.4167965361317649 0.76815122622941745;1.1774640468486171 0.57653422672984955 -1.895866501057391 1.2140036227972049 -1.3256963970766922;-1.6708616238951923 -1.6763294041510068 -0.90463571889140026 0.50930655147243997 -0.79262164606064633;-0.7585152678155711 1.5235315853148246 1.1263062782953805 0.49180773411670542 1.7211387149909363;1.8108561669704852 -1.076649014139929 -0.22039956351592677 -0.26049305297562203 0.97929437888045145;-1.5120680682955421 -1.5606964034964401 2.0243384885110935 0.34176427424153993 -0.60001305432261098;1.0712025590989134 -1.2593475080984018 -1.0645659968739336 -1.1695929039277206 -1.3531772868296499;2.8375978009335716 -0.56256954321676689 0.37935911810560119 0.49873755079391413 1.4380890451325932;1.5698540683861477 -0.55972753478068416 -0.11869833273932326 -1.1642517155093375 -1.9165887018780137;1.2928611767206963 -1.0299739847892972 2.2428814656581002 0.70231262843486642 -0.8150421973952654;2.051303158056641 -0.073576180659664106 0.51917175128245885 -1.1888039770381951 -1.3968769824613214];

% Layer 2
b2 = [0.33963236909661776;0.22811392647028786;-0.41811073652585984];
LW2_1 = [-1.8507681280284387 -0.237883678346272 -1.2687081449485531 0.068029744672908815 0.065842266290601567 0.24371253836734785 -0.23271799671133575 -0.88114533395607808 0.77165658094455503 1.396776754556206 -0.91407042426657392 1.0566045836693831 -0.042526138806979578 -1.1580897694472125 0.0072284870573175227 1.2865967292500149 1.0329927619322476 1.6471304237219015 0.82262092475545967 -0.27057502216324542 -0.064211775447064551 1.1962229135224085 -0.51307690898424552 0.037848310605408345 -0.031494964719001331 -0.95897552886348669 -0.83752860022616249 0.48360481544385447 -1.9750492757279747 -0.67222562363578464 -0.37126529431657068 -0.22217529617816534;0.97023116609882676 -0.63784118567941495 1.1077416979299755 0.43678990179294858 -0.034933496134123304 -0.27879475168320011 -0.44617249030733808 0.91667380999305581 0.9844665466648902 -0.53065365446756696 -0.27841028571136933 -0.52238585123844461 -0.065202060415663315 -0.12721540366724232 1.1555744150101104 -1.9380015183027983 0.0078920866393182437 -0.024355538470206103 0.77255187479064003 1.1700857147630812 0.35595032415850009 0.72088100337474903 1.0832091196394806 -1.1807724306806853 0.16901717175660308 0.85959036924471122 -0.92016061867761245 -0.66330733935582487 -0.44865314300945364 -0.29248836191036254 1.006852367983329 -0.62020361423699344;-0.59556031894241901 0.66927689898086518 0.24523523726227306 -0.88292286505363371 0.33719771625732375 1.1930444496520192 1.118188205304854 -0.90181962225802026 0.13624999584327879 0.045608454581408553 0.068356884068613816 -0.31581013404850145 0.41686824097405029 -0.7059003115296445 -0.021881708341572534 0.72743592551957437 0.48357514060513235 -0.4794804256592185 -1.5329839699857339 -0.38770767705851439 -0.3422702338448908 -0.48866492419569685 0.57228071845612283 0.28737217528312758 -0.11117712004257053 0.035837122933683421 0.24045310067578748 0.60841771251671373 1.5649012014792336 -0.12490995456118235 0.98662190193325039 0.7215344139860782];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
