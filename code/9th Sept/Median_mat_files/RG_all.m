function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 13-Sep-2016 09:39:17.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1.65884894871197;1.55095105336276;1.66415058335307;3.56593361078692;3.45662522547845;3.60147221533988;0.7278231110533;0.725898031813287;0.72929452623846;13.3568434105256;16.3443348591275;13.2878855205591];
x1_step1_gain = [2.31372569632665;2.01088551726332;2.38644916542203;0.71947883299075;0.706073129355454;0.618678865714721;6.13300480824191;6.39335879958422;6.97694106817823;0.0887938864162567;0.0971743820705624;0.0989044886412822];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.363394615604494;-1.7575374960858545;1.7803948737089708;1.5034155209792943;1.3086082824401852;-1.258190993512275;-0.85077002515014011;-0.78004804407474337;0.72791124061714396;0.7383098158841338;0.45713745559750568;-0.3827549482332207;0.39852194187200918;0.14034004398750682;-0.19100238476552583;-1.2055747536708821;0.61277636142395775;0.90286246546537896;-0.95951668429991566;1.1408960348021497;1.2153630020468749;-1.3001588424153714;1.8567657573151466;1.6666432575121337;1.6709318680596263];
IW1_1 = [0.32858750478812437 -0.53242296035768077 0.55651110730611886 0.32176139178266189 -0.25355788520652156 0.18855928664636606 -0.0088534953485659706 0.32121599588356231 0.31617851474845882 -0.4572961727793165 0.75799207612115271 -0.43916860396178947;0.56076024782542155 -0.94151171197098504 0.45003845209544335 0.24920259232191874 0.0092070458261237324 0.089349298716310976 0.51317860531160187 -0.38730736713562436 0.16625970516019128 0.52739445676971164 -0.70764447667237396 0.7278511812087225;0.35973357066264089 0.70676951572829605 -0.42401018599924101 -0.039534464309442352 -1.2458928740937967 -0.39106216229955765 -0.70968753037427845 -1.0928984429294044 0.085902591483017432 -0.29040485255957182 0.40847950917370862 0.7568457406977015;-0.12122332540953643 0.63078167797543994 -0.150081732946691 0.72733280940063283 1.1105984369238338 -0.42140539125393817 -0.79216144417423462 0.061833650552928998 -0.039937859495150246 0.091730757795887893 0.32336002178947132 -0.10619934618248902;0.18513494566868444 -0.017290242692991804 -0.067879113777209538 0.55685285949478946 1.3292210475976527 -0.074569268267918667 0.59425915762103243 -1.6792796771029215 -0.96363043635145051 0.76864965681806652 0.099834588968252536 1.1049556085754813;0.49196255710218045 0.41996550771319757 -0.85758197449272955 0.79605351021675763 0.31735304870007441 0.46839145239824842 -0.16529568521502475 -0.33322587415769978 0.33032097106199015 -0.5690561418244855 -0.24469477598131678 -0.53712652875935929;0.60936577982963847 -0.3920561374041453 0.042053771072309204 -0.42845503773832017 0.28747474204377704 -0.68149225109301192 -0.64119032744503057 -0.86549179450901825 -0.69973379350654463 0.66403432656646666 -0.28501025147401693 -0.094607563126776192;0.71041297929860336 0.89890194754193486 -0.37773237855415254 0.66811450898499392 0.40123115419452915 0.77220255513614422 0.6181243993931077 0.39242082969071629 -0.33287744112989365 0.47473514997912614 0.62203361455319439 0.23347149533085249;-0.66025301495792377 0.16981023634766876 0.39905406531860832 0.040687794092556788 0.42240164718212886 -0.41155597549032885 0.50004763625168036 -0.56120966178575604 -0.47231151541076483 -0.9837994883516914 -0.61007293246006578 -0.49983884378454851;-1.2797842030093785 0.046479136871764339 1.4791369610234482 -0.15857844658557663 0.14743869300985071 -0.15849790601046221 -0.05097921813492623 -0.68816652552398883 0.92001257995035501 0.34390415288081289 -0.45889656888156743 0.81768934868728216;0.38435903777827241 -0.63817732330491039 1.1278725834839041 -0.64404393148618155 -0.69461142314823188 0.55634751032763996 0.10156045456303818 -0.59627853157923838 -0.70738666313522347 -0.1454276597714344 1.2997692297518149 0.84720857585517484;-0.60098861734739606 -1.4124712881864649 0.0034044881614758576 0.64563121242232813 0.73171048618623735 -0.14214028292954298 -0.077695829595918128 0.02892946639195601 1.1357568932119522 -0.048791222088992357 0.77924803619301031 0.58856700437829113;-0.7371103238466199 0.36920288425339803 0.39234170484019859 -0.75521809824112063 -0.26089902464228809 0.10863590051077801 -0.92180132440552032 0.30541543144029976 0.12467540411093342 -0.72490920262050873 -0.24684988910235961 -1.3963656085397451;0.45489726993280094 0.32669731044692463 -0.24818285953920141 -0.40915098769366176 0.66221689892094815 -0.75210933082226517 -0.8923526225297117 0.44702681994636417 -0.74843855114417435 -0.66340445035892393 0.11285074405817047 0.40438960331011292;-1.0292500974127023 0.45240415615453095 -0.67592266350797381 1.0997452062734117 0.27989292382294562 0.13450872484136828 -0.28664791404977552 -0.79656003031578582 -0.34958167364997983 0.48991468127417198 -0.80379497459727411 0.44440896985512574;-1.3243602868067799 -0.27718657933976487 -1.7141608930786687 0.81753910894588555 0.015937387681437404 -1.0408236454317599 0.81013453458781703 -0.072096368690521773 0.41120819355367105 0.176367136701778 0.1621919734380283 -1.2672943987517551;-0.82986453522134573 -0.3843235414325723 -0.82179351221538588 -0.7443652012897698 0.50757917191047874 2.1342771306166197 0.40118251026951401 1.2500159808248958 1.7158275968851173 0.89234100536051064 0.0097026702895933736 -0.56336152448644872;0.63276141059812419 0.95645518165311494 0.0037098186596410468 -0.55559315908032925 0.48922052841934033 -0.31664194497228465 0.18272782981233687 0.69048462831363056 -0.25500280900814198 0.18952348012718689 0.57266030402440893 0.36076240788094094;-0.78549069933903259 -0.40140163759855585 0.48459953882293033 0.37527836723322155 0.028557235736263155 -0.37904610109573883 0.72737415445963349 0.29828578403868916 -0.60710130262468698 -0.75839902679392268 -0.15386182142547106 -0.64800137365183064;0.80403662907107676 -0.56536253557279181 1.404843485195721 -1.0080641774562398 0.23577214568884375 0.31968285047052769 -0.85600375959853059 -1.0745860836946071 0.64682754711743062 0.099870783079111417 0.57699944792837932 -0.26481706158773294;0.29899164261813677 0.60168803833434059 0.73262961486860556 -0.75457205034864516 -0.29756295750944578 -0.464286675801657 0.020779341062668974 0.64684912772824421 -0.41247321356751149 0.2966239459870017 -0.8465146369285006 0.84895016242674759;-0.20393135859616587 -0.22384491718227012 0.041952318639428249 -0.59368182742040188 0.55472250346838026 -0.72303109794517795 -1.0124058863957854 -0.78332946074190657 -0.11026260284759153 -0.57057178735065228 0.7160375930020465 0.14030244197184427;0.5876490352291126 -0.4620611148711109 -0.6266913147747063 -0.84075246412212523 0.47103612465763278 0.71307803100268807 -0.11768360852005719 0.36053910981873988 0.31162819991615948 -0.58841238375484339 -0.05374612459523409 0.33739667697476311;0.6527129086330935 -0.57483867284549572 -0.28375869269225201 -0.52989422037509393 0.67665179191413438 0.43618118333908468 0.51056593644963211 0.11610302643256047 -0.69621853047086124 0.22782617796320509 0.24341122773738916 -0.88269124371367058;0.28618447937974717 -0.36590187865550949 0.80031227647770276 -0.40273500415109381 0.0467100278005496 0.20397372895588647 0.38377074350818102 -0.5697946460193527 -1.0731959591906906 -0.4459674291691797 0.16478782006737422 -1.1359201387076394];

% Layer 2
b2 = [-0.69336518058453189;-0.71123232880877008];
LW2_1 = [-0.39806282646226121 0.72369082625576886 0.397815488373227 0.076576272168461801 -1.1583906816736551 0.53325245037220093 0.74608346997281394 1.4297177542979118 -0.078289103522931738 0.17857372354996026 -0.95752975255479322 -0.1358540355959143 -0.57212015578813702 0.23703361335106471 -0.34362614154882515 0.82279670136540006 -1.8638459091450268 0.34229018885484697 -0.44218904025368955 -0.97587908393459455 -0.44139183447970737 0.49973629649975665 0.27857726381448589 0.7481502608614341 0.019918050316786971;-0.36121965320251898 0.65671715962138322 -0.91420558498193794 0.18302024306098436 1.4260346900037282 0.52203630270636781 0.64828687727796575 -0.2368467108213165 -0.20657000055842203 -1.2028592863460104 1.0493105119050208 0.60554238914219349 0.63669091264018962 -1.4476249101418139 0.62983397914344008 -0.87466537406612566 1.491296185826017 1.1006807259983371 0.3020325038088309 0.532969191054813 0.16069462320106906 0.066962272543159909 -0.44922962637191888 0.21729543631969211 -1.3053949844700992];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end
% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end