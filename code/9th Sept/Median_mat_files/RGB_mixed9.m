function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 10-Sep-2016 23:57:59.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 12xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [1.61979124040807;1.55095105336276;1.66415058335307;3.87774840097201;3.68276178867394;3.8663631061544;0.7278231110533;0.728023809292788;0.72929452623846;15.0073449557567;16.0341644910475;13.2878855205591];
x1_step1_gain = [2.21370092252636;1.97367098659041;2.43716850689811;0.871044282880543;0.767332735788631;0.673898953228494;6.13300480824191;6.43710166742837;4.43373392149694;0.0958149391115804;0.0957316763256615;0.0989044886412822];
x1_step1_ymin = -1;

% Layer 1
b1 = [0.43773978774931904;1.0956584785143406;-4.9794878679623276;-2.6828254373299698;0.54983606127989071;-1.3144104768980465;1.0850495854137305;1.1351566719028687;-2.0959115415168577;-2.0448637270152159;-1.5757196870597225;1.9010985078860068;0.91435972024315249;-0.98696954314588892;1.4282042608486878;1.3951332120798019];
IW1_1 = [-3.7406922083279834 -0.80253882549148492 -0.82079396448935993 -1.8505393332789928 -0.13773772881383795 -2.1201098971138634 -2.6001239790200956 -2.557172095351715 0.20173874197268091 -0.12536992066592942 -1.2743448134437092 1.3848055536902406;-0.40262356596738852 1.6682112675030905 0.3275777838659773 0.63916123014912896 -2.1909339468945603 -1.4768585317176128 0.90132032793887717 0.26979336747627125 -0.4801874736762024 0.52970441922296663 0.28747938257234623 -0.99309101635719776;2.0910011238109187 4.6016011220236113 -1.5196065971892869 -1.6672778958602288 -3.7737601100505422 1.7352400975705387 -3.2736278333134918 -0.13182986805174707 0.36042918949638109 1.1306112076990327 -0.00033265628452287116 1.4643049719666226;1.2026583946219933 2.8934745182310362 1.6102400967898833 -0.56456162641389451 -0.33543433248789378 1.5736081271680769 -0.090638471570453613 0.93525082301509332 0.29341169872454859 0.47546465718226838 1.6812376089429171 1.182295831409433;-0.45351338193413371 0.65147589207183532 4.1407780071931528 1.5965438722652201 2.2808264701781367 0.40100737965887673 0.71881981757919888 0.38150604816646971 -1.5556588647043073 0.20625338637488846 0.66409113256875052 -0.092335858985366698;1.053555116967265 -0.54553655195596962 0.85831712685345474 0.83813361858079782 -0.45048703231677512 1.2291153813376938 -0.34274103993610017 0.30594011671524818 -2.5321961248723515 -1.2093445344529954 -1.7300892610679461 1.0806865611623664;-3.3582071327763106 -1.2871538635499684 -3.8438608432195656 3.8846833792972628 0.73095944643707966 1.1650829260445446 0.80029402271977235 -2.4889050208834118 0.27441267883804538 0.47044025438557607 -0.4125561052074686 1.1719162652619315;-1.2348113451132898 2.6900154477311711 -2.359452252224052 -2.538629148738639 1.4403756555453331 -1.0681214498259082 -1.0324498069123031 0.25287328677080478 -0.85318846588910324 0.018784353948178928 5.3016370923547029 0.10667773685000803;-0.73877603648965073 -0.48757225857872166 -0.47237485741683771 -0.47210033178352184 -0.55757222637412418 0.3110083521596203 0.7008862501931975 0.40565859335460774 2.2460148931425152 -0.16067024834095403 0.33176624761942619 -0.10311377202341827;-0.73699640312354697 -3.1493734595070251 1.3000222559768122 4.2609288111063384 -1.9843847923014946 -0.27139420518109647 0.033319653163631224 1.0533493912362344 -1.0305346519967848 3.3373266211154506 -4.0603378505544931 2.0659043975171869;0.47657885316668863 -0.95374452524274866 0.32572800660776074 0.11793168227373535 2.7233765897620108 0.544649248055321 -0.28901313460349687 0.18923340813244338 2.0864369278362394 1.1179884658089567 -0.071014942980535609 -0.31290252519866957;0.17523241141662418 0.59944150891137793 1.1650385366668323 1.6793212159331765 -2.4418270245107365 3.5063682042415296 -0.4776798801096076 0.5387965622297608 -1.3833789304452342 2.2957423366703575 -0.71011412230084014 0.2151940595886998;1.3443507682132938 1.253093739726661 0.11613276167503296 -1.4110850369278407 2.9450434198041084 -0.020373571078176327 -0.18652620836247089 -1.026443570254419 0.55055610744544103 0.18863292861744155 -0.89886145501043568 -0.9304427464708902;-0.64347759212274058 -0.45040144535766663 -3.088246514899204 -0.92468297007808931 0.51046432495840433 -1.5977939554222009 2.1618457957338757 2.7142389008482093 -2.1390932411017252 -0.39900263305381939 1.5790335718046165 -0.099118344199178157;0.89181267667381248 0.062033913550223016 0.38335027467581617 3.607917003990972 0.020775032924983828 -2.2107016136131694 0.4729427883230799 1.477929209061895 -1.2822060661575192 -2.7228868298997311 -0.33185736336238852 1.8237699742405786;2.8295135460257463 0.087214615487723884 3.2081474531863301 -0.50227410891143842 0.88118778408622411 0.62317292293887849 -0.10977793202559441 -0.6811094540953383 0.44686417575299703 -0.54486795690740086 -1.6808143271889777 0.28387749126359418];

% Layer 2
b2 = [0.68305286068530169;-0.37822450792604645;-0.76407959483038768];
LW2_1 = [-5.6662900445969493 2.7684622951741398 -5.6528244888166697 -0.69311225930590015 -2.7507558633761238 -0.089784977129392346 -3.9085592608631736 5.3966359871991596 0.38129206098083956 1.7598332416824012 -2.0180990107252401 -2.2378754009766983 -1.5739470448729616 -2.2331504013739529 2.5676443336714874 -1.4985351431048424;0.65560165126578018 0.79150130892116011 -1.3777516867066324 -2.6889489431003879 3.8408886696925424 -1.7346838026166032 2.9735773687261964 -3.0451669609068279 -0.49765804270191594 -6.0693879535979649 0.80681480798727412 3.0064218105600511 2.1399136025108305 3.7126324909951944 -4.3338758649264753 -3.0110122016493199;4.6780204306993589 -1.7717057948609332 6.6023264761520117 1.6352761565700744 0.13621445936588542 1.5667545430130825 0.14014134447717147 -2.0025119718426292 -0.81786960869221226 4.2264137185544222 0.74742104820473176 -1.6963308856977755 1.1122239143592207 -3.3249400683459567 0.74669495169166855 3.4166906406254909];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numer = exp(n);
denom = sum(numer,1);
denom(denom == 0) = 1;
a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
